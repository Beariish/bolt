import * from core

type Vec2 = {
    x: number,
    y: number,
}

fn Vec2.new(x: number, y: number) {
    return Vec2 => { x: x, y: y }
}

method Vec2.@add(other: Vec2) {
    return Vec2 => { x: this.x + other.x, y: this.y + other.y }
}

type Entity = {
    pos: Vec2,
    id: string,
}

type Player = Entity + {
    velocity: Vec2
}

fn Entity.new(x: number, y: number) {
    return Entity => {
        pos: Vec2.new(x, y),
        id: "Entity"
    }
}

method Entity.@format {
    return "Entity with name '" + this.id + "'"
}

fn Player.new(x: number, y: number) {
    let player = Entity.new(100, 100) & {
        velocity: Vec2.new(0, 0)
    } into Player!

    player.id = "Player"

    return player
}

method Player.@collect {
}

let player = Player.new(100, 100)
let entity = Entity.new(200, 200)

print(entity)
print(player)

fn print_type(x: bool | number | string | null) {
    if x is number { print("We got a number:", x) }
    else if x is string { print("We got a string:", x) }
    else if x is bool { print("We got a boolean:", x) }
    else { print("We got nothing...") }
}

print_type(10)
print_type(100)
print_type("hello")
print_type("world")
print_type(null)

fn is_even(x: number): bool | string {
    if x < 0 { return "Error, no negative numbers allowed!" }

    return true
}

print_type(is_even(10))
print_type(is_even(20))
print_type(is_even(-20))

type Error = unsealed { what: string }
fn error(message: string) { return Error => { what: message } }

fn pow(x: number, exp: number) {
    if abs(x) + abs(exp) < 0.00001 {
        return error("0 to the power of 0 is not defined!")
    }

    let accum = x
    for i in exp {
        accum *= x
    }

    return accum
}

// "pow" implicitly has the return type `number | Error`

print(pow(10, 2))
print(pow(2, 8))
print((pow(0, 0) into Error!).what)


let a: bool | string | number = false
let b: string | number = 100

a = b // this is fine! b is narrower than a

for i in "long string".length() {
    print(i)
}

for i in string.length("long string") {
    print(i)
}

return 0