import * from "../../test"

import Error from core
import meta

push_scope("unclosed")

test("unclosed string", fn {
    expect(meta.try_compile("\"this is a string", "unclosed_string") is Error, "Expected unclosed string to error gracefully")
})

test("unclosed paren", fn {
    expect(meta.try_compile("
        fn add(a: number, b: number): number { return a + b }
        add(10, 20
    ", "unclosed_paren") is Error, "Expected unclosed paren to error gracefully")
})

test("unclosed paren in param list", fn {
    expect(meta.try_compile("fn add(a: number, b: number", "unclosed_paren_param_list") is Error, "Expected unclosed paren in param list to error gracefully")
})

test("unclosed function body", fn {
    expect(meta.try_compile("fn add(a: number, b: number) { return a + b", "unclosed_fn_body") is Error, "Expected unclosed function body to error gracefully")
})

test("unclosed array literal", fn {
    expect(meta.try_compile("[1, 2, 3, 4", "unclosed_array") is Error, "Expected unclosed array literal to error gracefully")
})

test("unclosed table literal", fn {
    expect(meta.try_compile("{ a: 10, b: true", "unclosed_table") is Error, "Expected unclosed table literal to error gracefully")
})

test("unclosed type() literal", fn {
    expect(meta.try_compile("let x: type(number", "unclosed_type") is Error, "Expected unclosed type() literal to error gracefully")
})

test("unclosed typeof() literal", fn {
    expect(meta.try_compile("let x: typeof(10", "unclosed_typeof") is Error, "Expected unclosed typeof() literal to error gracefully")
})

test("unclosed let binding", fn {
    expect(meta.try_compile("let x:", "unclosed_let") is Error, "Expected unclosed let: binding to error gracefully")
})

test("unclosed if block", fn {
    expect(meta.try_compile("if true {", "unclosed_if") is Error, "Expected unclosed if block to error gracefully")
})

test("unclosed else block", fn {
    expect(meta.try_compile("if true { } else {", "unclosed_else") is Error, "Expected unclosed else block to error gracefully")
})

test("unclosed else if block", fn {
    expect(meta.try_compile("if true { } else if true {", "unclosed_elseif") is Error, "Expected unclosed else if block to error gracefully")
})

test("unclosed for block", fn {
    expect(meta.try_compile("for true {", "unclosed_for") is Error, "Expected unclosed for block to error gracefully")
})

test("unclosed expression into block", fn {
    expect(meta.try_compile("if 10 + {}", "unclosed_expr_into_block") is Error, "Expected unclosed expression into block to error gracefully")
})


test("unclosed paren into block", fn {
    expect(meta.try_compile("fn f() {} if f( {}", "unclosed_paren_into_block") is Error, "Expected unclosed paren into block to error gracefully")
})

pop_scope()